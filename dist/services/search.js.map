{"version":3,"file":"search.js","sources":["../../src/services/search.js"],"sourcesContent":["import Service from '@ember/service';\nimport { task } from 'ember-concurrency';\nimport { set } from '@ember/object';\nimport algoliasearch from 'algoliasearch';\nimport { getOwner } from '@ember/application';\n\nexport default class SearchService extends Service {\n  results = [];\n\n  constructor() {\n    super(...arguments);\n    const config = getOwner(this).resolveRegistration('config:environment');\n\n    const { algoliaId, algoliaKey, indexName } = config['algolia'] || {};\n\n    if (algoliaId && algoliaKey && indexName) {\n      this.client = algoliasearch(algoliaId, algoliaKey);\n      this.index = this.client.initIndex(indexName);\n    }\n  }\n\n  search = task(async (query, projectVersion) => {\n    const searchObj = {\n      hitsPerPage: 15,\n      restrictSearchableAttributes: ['content'],\n    };\n\n    if (projectVersion && projectVersion.match(/\\d+\\.\\d+\\.\\d+/)) {\n      searchObj.facetFilters = [[`version:${projectVersion}`]];\n    }\n\n    return set(this, 'results', await this.doSearch(query, searchObj));\n  });\n\n  doSearch(query, searchObj) {\n    return this.index.search(query, searchObj).then((results) => {\n      return results.hits;\n    });\n  }\n}\n"],"names":["SearchService","Service","results","constructor","arguments","config","getOwner","resolveRegistration","algoliaId","algoliaKey","indexName","client","algoliasearch","index","initIndex","search","_buildTask","context","generator","query","projectVersion","searchObj","hitsPerPage","restrictSearchableAttributes","match","facetFilters","set","doSearch","then","hits"],"mappings":";;;;;;;AAMe,MAAMA,aAAa,SAASC,OAAO,CAAC;AACjDC,EAAAA,OAAO,GAAG,EAAE;AAEZC,EAAAA,WAAWA,GAAG;IACZ,KAAK,CAAC,GAAGC,SAAS,CAAC;IACnB,MAAMC,MAAM,GAAGC,QAAQ,CAAC,IAAI,CAAC,CAACC,mBAAmB,CAAC,oBAAoB,CAAC;IAEvE,MAAM;MAAEC,SAAS;MAAEC,UAAU;AAAEC,MAAAA;AAAU,KAAC,GAAGL,MAAM,CAAC,SAAS,CAAC,IAAI,EAAE;AAEpE,IAAA,IAAIG,SAAS,IAAIC,UAAU,IAAIC,SAAS,EAAE;MACxC,IAAI,CAACC,MAAM,GAAGC,aAAa,CAACJ,SAAS,EAAEC,UAAU,CAAC;MAClD,IAAI,CAACI,KAAK,GAAG,IAAI,CAACF,MAAM,CAACG,SAAS,CAACJ,SAAS,CAAC;AAC/C,IAAA;AACF,EAAA;AAEAK,EAAAA,MAAM,GAAAC,SAAA,CAAA,OAAA;IAAAC,OAAA,EAAA,IAAA;AAAAC,IAAAA,SAAA,EAAA,WAAeC,KAAK,EAAEC,cAAc,EAAK;AAC7C,MAAA,MAAMC,SAAS,GAAG;AAChBC,QAAAA,WAAW,EAAE,EAAE;QACfC,4BAA4B,EAAE,CAAC,SAAS;OACzC;MAED,IAAIH,cAAc,IAAIA,cAAc,CAACI,KAAK,CAAC,eAAe,CAAC,EAAE;QAC3DH,SAAS,CAACI,YAAY,GAAG,CAAC,CAAC,CAAA,QAAA,EAAWL,cAAc,CAAA,CAAE,CAAC,CAAC;AAC1D,MAAA;AAEA,MAAA,OAAOM,GAAG,CAAC,IAAI,EAAE,SAAS,EAAA,MAAQ,IAAI,CAACC,QAAQ,CAACR,KAAK,EAAEE,SAAS,CAAC,CAAC;AACpE,IAAA;AAAC,GAAA,CAAA,EAAA,IAAA,EAAA,QAAA,EAAA,IAAA,CAAA;AAEDM,EAAAA,QAAQA,CAACR,KAAK,EAAEE,SAAS,EAAE;AACzB,IAAA,OAAO,IAAI,CAACR,KAAK,CAACE,MAAM,CAACI,KAAK,EAAEE,SAAS,CAAC,CAACO,IAAI,CAAE1B,OAAO,IAAK;MAC3D,OAAOA,OAAO,CAAC2B,IAAI;AACrB,IAAA,CAAC,CAAC;AACJ,EAAA;AACF;;;;"}